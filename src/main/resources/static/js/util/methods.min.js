async function asyncAjax(e,o={},t="POST",a="JSON",n=null){let l;try{return l=await $.ajax({url:e,type:t,data:o,dataType:a,...n?{contentType:n}:null}),l}catch(e){return l={data:null,success:!1,dbCode:-1,message:e},l}}moment.locale("es");let xhr=null,basePath=$("#hid_basePath").val();keyup_input_general_3=((e,o,t)=>{$.each($(e),function(){$(this).on("keyup",function(){estilo_error(!1,this)})})}),estilo_error=((e,o)=>{!0===e?($(o).closest(".form-group").addClass("has-error"),$(o).addClass("error-input")):($(o).closest(".form-group").removeClass("has-error"),$(o).removeClass("error-input"))});var Redondear2=function(e){var o=parseFloat(e);return o.toFixed(2)},Redondear7=function(e){var o=parseFloat(e);return o.toFixed(7)},Redondear1=function(e){var o=parseFloat(e);return o.toFixed(0)},Redondear3=function(e){var o=parseFloat(e);return o.toFixed(3)},Redondear4=function(e){var o=parseFloat(e);return(o=e+"%")?e:o.toFixed(2)},formatearNumero=function(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var o=/(\d+)(\d{3})/;o.test(x1);)x1=x1.replace(o,"$1,$2");return x1+x2},sombrearRow=function(e,o){$(e).css("background-color","rgb(176, 190, 217)"===$(e).css("background-color")?"#FFFFFF":"#B0BED9");for(var t=$(e).children(),a=0;a<o;a++)$(t[a]).css("background-color","#FFFFFF")},sombrearSingleRow=function(e){$.fn.DataTable.isDataTable("#tblAvance")&&($("#tblAvance tbody tr").each(function(){$(this).css("background-color","#FFFFFF")}),$(e).css("background-color","rgb(176, 190, 217)"===$(e).css("background-color")?"#FFFFFF":"#B0BED9"),$(e).children().each(function(){console.log($(this).text())}))},FormatoFechaSinRestriccion=function(e,o){$(e).datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,todayHighlight:!0,autoclose:!0,format:o,language:"es"})},FormatoFecha=function(e,o){$(e).datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,todayHighlight:!0,autoclose:!0,format:o,endDate:new Date,language:"es"})},FormatoStartFecha=function(e,o,t){$(e).datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,todayHighlight:!0,autoclose:!0,format:o,startDate:new Date(t),language:"es"})},FormatoFechaIniciaHoy=function(e,o){$(e).datepicker({todayBtn:"linked",keyboardNavigation:!1,forceParse:!1,calendarWeeks:!0,todayHighlight:!0,autoclose:!0,format:o,startDate:new Date})};let collapseDiv=function(e,o,t){$(".collapse.show").each(function(){$(this).prev(e).find(".fa").addClass(t).removeClass(o)}),$(".collapse").on("show.bs.collapse",function(){$(this).prev(e).find(".fa").removeClass(o).addClass(t)}).on("hide.bs.collapse",function(){$(this).prev(".panel-heading").find(".fa").removeClass(t).addClass(o)})};var NumeroDosDecimales=function(e){$(e).inputmask("decimal",{min:0,integerDigits:7,allowMinus:!1,digits:2}),$(e).on("blur",function(){""!==$(this).val()&&"0.00"!==$(this).val()&&$(this).val(Redondear2($(this).val()))})},NumeroDosDecimalesConBlur=function(e){$(e).inputmask("decimal",{min:0,integerDigits:7,allowMinus:!1,digits:2}),$(e).on("blur",function(){""!==$(this).val()&&"0.00"!==$(this).val()&&$(this).val(Redondear2($(this).val()))})},NumeroDosDecimalesCero=function(e){$(e).inputmask("decimal",{min:0,integerDigits:7,allowMinus:!1,digits:2}),$(e).on("blur",function(){""!==$(this).val()?$(this).val(Redondear2($(this).val())):$(this).val("0.00")})},NumeroPorcentajeDosDecimales=function(e,o,t,a){$(e).inputmask("decimal",{min:t,max:a,integerDigits:o,allowMinus:!1,digits:2})},NumeroEntero=function(e){$(e).inputmask("integer",{min:0,integerDigits:7,allowMinus:!1})},uploadMsnFullWidth=(NumeroEntero=function(e,o){$(e).inputmask("integer",{min:0,integerDigits:o,allowMinus:!1})},function(){toastr.options={closeButton:!0,debug:!0,progressBar:!0,preventDuplicates:!1,positionClass:"toast-top-full-width",onclick:null,showDuration:"5000",hideDuration:"5000",timeOut:"10000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr.error("Su Session ha expirado","Mensaje del Sistema")}),uploadMsn=function(e,o){toastr.options={closeButton:!0,progressBar:!0,positionClass:"toast-top-full-width",showMethod:"slideDown",hideMethod:"fadeOut",timeOut:8e3},"OK"===o?toastr.success(e,"Exito"):"ERROR"===o&&toastr.error(e,"ERROR")};const uploadMsnSmallNotDuplicate=(e,o)=>{toastr.options={closeButton:!0,preventDuplicates:!0,showMethod:"slideDown",hideMethod:"fadeOut",timeOut:6e3},"OK"===o?toastr.success(e,"Exito"):"ERROR"===o?toastr.error(e,"ERROR"):"ALERTA"===o&&toastr.warning(e,"Alerta del Sistema")};let uploadMsnSmall=(e="",o="INFORMACIÓN")=>{switch(toastr.options={closeButton:!0,showMethod:"slideDown",hideMethod:"fadeOut",timeOut:6e3},o){case"OK":toastr.success(e,"Exito");break;case"ERROR":toastr.error(e,"ERROR");break;case"ALERTA":toastr.warning(e,"Alerta del Sistema");break;default:toastr.info(e,o)}};var uploadMsnSmallLeft=function(e,o){toastr.options={closeButton:!0,showMethod:"slideDown",positionClass:"toast-top-left",hideMethod:"fadeOut",timeOut:6e3},"OK"===o?toastr.success(e,"Exito"):"ERROR"===o?toastr.error(e,"ERROR"):"ALERTA"===o&&toastr.warning(e,"Alerta del Sistema")},CerrarSession=function(){$("#form_logout").submit()};let countNotify=0,searchNotifyEnable=!0,listNotify=[],openNotify=!1,notifySpan=$("#notifySpan"),notifyUl=$("#notifyUl"),pageNumberNotify=0;const URL_NOTIFY=`${basePath}/notification`;var estilo_error_busqueda=function(e,o){!0===e?($(o).addClass("has-error"),$(o).addClass("error-input")):($(o).removeClass("has-error"),$(o).removeClass("error-input"))},style_error_cbo_final=function(e,o){!0===o?$(e).closest(".form-group").addClass("has-error"):$(e).closest(".form-group").removeClass("has-error");var t=o?"style_cbo":"red error-input",a=o?"red error-input":"style_cbo";$(e).selectpicker("setStyle",t,"remove"),$(e).selectpicker({style:a,size:5}),$(e).selectpicker("refresh")},style_error_cbo_final_busqueda=function(e,o){!0===o?$(e).addClass("has-error"):$(e).removeClass("has-error");var t=o?"style_cbo":"red error-input",a=o?"red error-input":"style_cbo";$(e).selectpicker("setStyle",t,"remove"),$(e).selectpicker({style:a,size:5}),$(e).selectpicker("refresh")},validarPerfil=function(){var e="1";return""===$("#claveanterior").val()&&(estilo_error(!0,"#claveanterior"),e="0"),""===$("#clavenueva").val()&&(estilo_error(!0,"#clavenueva"),e="0"),""===$("#reclavenueva").val()&&(estilo_error(!0,"#reclavenueva"),e="0"),""!==$("#clavenueva").val()&&""!==$("#reclavenueva").val()&&$("#clavenueva").val()!==$("#reclavenueva").val()&&(estilo_error(!0,"#reclavenueva"),uploadMsnSmall("Las Claves deben de ser Iguales.","ERROR"),e="0"),"1"===e},RetornarNombreDia=function(e){var o="";return 0===e?o="Domingo":1===e?o="Lunes":2===e?o="Martes":3===e?o="Miercoles":4===e?o="Jueves":5===e?o="Viernes":6===e&&(o="Sabado"),o},RetornarNombreMes=function(e){var o="";return 0==e?o="Enero":1==e?o="Febrero":2==e?o="Marzo":3==e?o="Abril":4==e?o="Mayo":5==e?o="Junio":6==e?o="Julio":7==e?o="Agosto":8==e?o="Septiembre":9==e?o="Octubre":10==e?o="Noviembre":11==e&&(o="Diciembre"),o},RetornarMesxNumero=function(e){var o="";return 1==e?o="Enero":2==e?o="Febrero":3==e?o="Marzo":4==e?o="Abril":5==e?o="Mayo":6==e?o="Junio":7==e?o="Julio":8==e?o="Agosto":9==e?o="Septiembre":10==e?o="Octubre":11==e?o="Noviembre":12==e&&(o="Diciembre"),o};keyup_input_general_3("#frmMyPerfil input","#frmMyPerfil","#modalMyPerfil");var reloadSession=function(){$.ajax({type:"post",url:`${basePath}/reload_session`,dataType:"json",success:function(e){null!==e?"OK"===e.dato||"ERROR"===e.dato&&uploadMsnSmall(e.msj,"ERROR"):uploadMsnSmall("Problemas con el sistema","ERROR")},error:function(e,o,t){uploadMsnSmall(e.responseText,"ERROR")}})},validarUndefinied=function(e){var o=null;return void 0!==e&&(o=e),o},fun_RestringirCampoDocumentoIdentidad=function(e,o){for(var t="",a="ABCDNIabcdni1234567890",n=0;n<e.length;n++)-1!=a.indexOf(e.charAt(n))&&t.length<o&&(t+=e.charAt(n).toUpperCase());return t};const fun_RestringirCampoNumericoSinDecimales=(e,o)=>{let t="",a="1234567890";for(let n=0;n<e.length;n++)-1!=a.indexOf(e.charAt(n))&&t.length<o&&(t+=e.charAt(n));return t};var fun_RestringirCampoNumericoSinDecimales2=function(e,o,t){for(var a="",n="1234567890",l=0;l<e.length;l++)-1!=n.indexOf(e.charAt(l))&&a.length<o&&(a+=e.charAt(l));$(t).val(a)},fun_RestringirCampoNumericoConPuntoDecimal=function(e,o){for(var t="",a="1234567890.",n=0,l=0;l<e.length;l++)"."===e.charAt(l)&&n++,-1!=a.indexOf(e.charAt(l))&&t.length<o&&n<2&&(t+=e.charAt(l));return t};const fun_RestringirCampoCorreoElectronico=e=>{let o="",t="@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-1234567890.",a=0;for(let n=0;n<e.length;n++)"@"===e.charAt(n)&&a++,-1!=t.indexOf(e.charAt(n))&&a<2&&(o+=e.charAt(n));return o};var fun_ValidarRangoHoras=function(e,o){var t=$(e).val().split(":"),a=$(o).val().split(":");return Number(t[0])==Number(a[0])&&Number(t[1])<=Number(a[1])||Number(t[0])<Number(a[0])},Redondear=function(e){var o="",t=parseFloat(e).toFixed(4),a=t.split(".")[0],n=t.split(".")[1],l=n.substring(0,1),r=n.substring(1,2),s=n.substring(2,3),i=r+"."+s,c=Math.round(i).toString();return 9==r&&10==c?(l=parseFloat(l)+1,10==l?(o=parseFloat(a)+1,o+=".00"):o=a+"."+l+"0"):o=a+"."+l+c,o},FormatoFechaAnio=function(e,o){$(e).datepicker({autoclose:!0,keyboardNavigation:!0,endDate:new Date,todayHighlight:!0,format:"mm-yyyy",startView:"months",minViewMode:"months",language:"es"})};let methods=function(){let e=function(){setInterval(reloadSession,24e4),setInterval(countNotifyAjax,6e4),countNotifyAjax()};return{init:function(){e()}}}();$("#btnSalir").on("click",function(){bootbox.confirm({message:"<strong>¿Esta Seguro que desea Salir del Sistema?</strong>",buttons:{confirm:{label:"<i class='fa fa-check'></i> Si",className:"btn-primary btn-sm sbold"},cancel:{label:"<i class='fa fa-times'></i> No",className:"btn-sm sbold"}},callback:function(e){e&&CerrarSession()}})}),$("#btnGuardarMyPerfil").on("click",function(){if(validarPerfil()){var e=Ladda.create(document.querySelector("#btnGuardarMyPerfil")),o=$("#claveanterior").val(),t=$("#clavenueva").val(),a=$("#reclavenueva").val();e.start(),$.ajax({type:"post",url:`${basePath}/save_myperfil`,data:{anterior:o,nueva:t,renueva:a},dataType:"json",success:function(o){if(null!==o){if("OK"===o.dato)$("#modalMyPerfil").modal("hide"),e.stop(),uploadMsnSmall(o.msj,"OK");else if("ERROR"===o.dato){if(o.listado.length>0)for(var t=0;t<o.listado.length;t++)"E1"===o.listado[t]&&estilo_error(!0,"#claveanterior"),"E2"===o.listado[t]&&estilo_error(!0,"#clavenueva"),"E3"===o.listado[t]&&estilo_error(!0,"#reclavenueva"),"E4"===o.listado[t]&&(estilo_error(!0,"#reclavenueva"),uploadMsnSmall("Las Claves deben de ser iguales.","OK"));else uploadMsnSmall(o.msj,"ERROR");e.stop()}}else e.stop(),uploadMsnSmall("Problemas con el sistema","ERROR")},error:function(o,t,a){e.stop(),uploadMsnSmall(o.responseText,"ERROR")}})}}),$("#myperfil").on("click",function(){$("#frmMyPerfil")[0].reset(),estilo_error(!1,"#claveanterior"),estilo_error(!1,"#clavenueva"),estilo_error(!1,"#reclavenueva"),$("#modalMyPerfil").modal("show")}),$("#btnCollapse").on("click",function(){$("#demo").hasClass("in")?$(this).children().removeClass("fa fa-chevron-up").addClass("fa fa-chevron-down"):$(this).children().removeClass("fa fa-chevron-down").addClass("fa fa-chevron-up")});const countNotifyAjax=()=>{$.ajax({type:"GET",url:`${URL_NOTIFY}`,data:{},dataType:"JSON",success:function(e){if(null!=e){let o=e.dato;if("OK"===o){let o=e.data;parseInt(o)>=0?(countNotify=parseInt(o),countNotifyShow()):(console.log("--- :( notificaciones ERROR ---"),uploadMsnSmall(o,"ERROR"),console.log(o))}else console.log("Respu ERROR: ",e.msj),uploadMsnSmall(e.msj,"ERROR")}},error:function(e,o,t){console.log("ERROR EN AJAX"),uploadMsnSmall(e.responseText,"ERROR")}})};countNotifyShow=(()=>{countNotify>0?(searchNotifyEnable=!0,notifyUl.html(""),pageNumberNotify=0,$("#notifyI").removeClass("fa-bell-o").addClass("fa-bell"),notifySpan.removeClass("force-hide"),countNotify>9?notifySpan.text("9+"):notifySpan.text(countNotify.toString())):($("#notifyI").removeClass("fa-bell").addClass("fa-bell-o"),notifySpan.addClass("force-hide"))}),$("#notifyA").click(function(){console.log("#notifyA click"),openNotify="true"!==$("#notifyA").attr("aria-expanded"),console.log("Is open ?: ",openNotify),openNotify&&searchNotifyEnable&&(searchNotifyAjax(),recivedNotify())}),recivedNotify=(()=>{console.log("recivedNotify"),$.ajax({type:"POST",url:`${URL_NOTIFY}/recivedNotify`,data:{},dataType:"JSON",success:function(e){if(null!=e){let o=e.dato;"OK"===o?"OK"===e.data&&(countNotify=0,countNotifyShow()):(console.log("Respu: ",o),uploadMsnSmall(e.msj,"ERROR"))}},error:function(e,o,t){console.log("ERROR EN AJAX"),uploadMsnSmall(e.responseText,"ERROR")}})}),searchNotifyAjax=(()=>{console.log("searchNotifyAjax: page ",pageNumberNotify),searchingNotify(),$.ajax({type:"POST",url:`${URL_NOTIFY}`,data:{_pageNumber:pageNumberNotify},dataType:"JSON",success:function(e){if(null!=e){let o=e.dato;if("OK"===o){let o=e.data;console.log("Resultado: ",o),listNotify=o,pageNumberNotify+=1,searchNotifyEnable=!(listNotify.length<8),showNotify()}else console.log("Respu: ",o),uploadMsnSmall(e.msj,"ERROR")}},error:function(e,o,t){console.log("ERROR EN AJAX"),uploadMsnSmall(e.responseText,"ERROR")}})}),profileImage=(e=>{console.log("user: ",e);let o="";switch(e){case"DSIS":o=`${basePath}/resources/assets/images/profiles/DSIS.svg`;break;default:o=`${basePath}/resources/assets/images/profiles/${Math.floor(7*Math.random()+1)}.svg`}return o}),$("#notifyUl").on("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight&&(console.log("End of List"),searchNotifyEnable&&searchNotifyAjax())});const showNotify=()=>{$("#searchNotifyDiv").remove(),$("#noneNotifyDiv").remove(),listNotify.length>0?$.each(listNotify,function(e,o){console.log("item: ",o,"i: ",e),notifyUl.append(`\n            <li> \n                <div onclick="${1===o.flagRead?`location.href='${basePath}/${o.link}'`:`notifyOpen('${o.id}', '${o.link}')`}" class="dropdown-messages-box" style="display: flex; border-bottom: 1px solid #e9ecef; padding-top: 5px; padding-bottom: 5px; margin-bottom: 3px; cursor: pointer; border-left-width: 5px; border-left-color: ${1===o.flagRead?"#fff":"#16a085"}; border-left-style: solid; ">                    <a class="dropdown-item float-left" href=${o.link} style="padding-right: 16px; padding-left: 6px;">\n                        <img alt="image" class="rounded-circle" src=${profileImage(o.userSend.codigo)} style="width: 38px; height: 38px;">\n                    </a>\n                    <div class="media-body">\n                        <strong>${o.userSend.nombre}</strong><br>\n                        ${o.title}.<br>\n                        <small class="text-muted">${moment(o.dateSend).fromNow()} ${moment(o.dateSend).format("[el] LLL")}</small>\n                    </div>\n                </div>\n            </li>\n            `)}):notifyUl.append('\n        <li> \n            <div id="noneNotifyDiv" class="dropdown-messages-box" style="display: flex; padding: 15px; justify-content: space-evenly; align-items: center;">\n                <i class="fa fa-comments fa-3x text-primary"/><br>\n                <strong>No tiene notificaciones.</strong>\n            </div>\n        </li>\n        ')};searchingNotify=(()=>notifyUl.append('\n        <li> \n            <div id="searchNotifyDiv" class="dropdown-messages-box" style="display: flex; padding: 15px; justify-content: space-evenly;">\n                <i class="fa fa-pulse fa-spinner fa-2x text-primary"/>\n            </div>\n        </li>\n        '));const notifyOpen=(e,o)=>{console.log("notifyOpen:"),console.log("id: ",e),console.log("link: ",o),$.ajax({type:"POST",url:`${URL_NOTIFY}/readedNotify`,data:{_id:e},dataType:"JSON",success:function(e){if(null!=e){let t=e.dato;"OK"===t?"OK"===e.data&&(window.location.href=`${basePath}/${o}`):(console.log("Respu ERROR: ",e.msj),uploadMsnSmall(e.msj,"ERROR"))}},error:function(e,o,t){console.log("ERROR EN AJAX"),uploadMsnSmall(e.responseText,"ERROR")}})};replaceMaxValue=((e,o=5,t=6)=>{let a=$(e).val(),n=new RegExp(`9{${o},}`);n.test(a)&&$(e).val("9".repeat(t))}),overflowY=((e,o)=>{if(o){let o=$(e).attr("style");$(e).attr("style",o+"; padding-left: 0 ; overflow-y: hidden !important;")}else{let o=$(e).attr("style");o=o.replace("; overflow-y: hidden !important",""),$(e).attr("style",o)}});const clearTable=async e=>{$.fn.DataTable.isDataTable(e)&&($(e).DataTable().clear().draw(),$(e).DataTable().destroy()),$(e).html("")},cancelarAjax=()=>{xhr&&4!==xhr.readyState&&xhr.abort()},mensajeAjax=(e,o,t=!0)=>{let a=null==t||t;a&&uploadMsnSmall("abort"===e?"Se canceló la operación.":o,"ERROR")},validarInput=(e,o,t="")=>{let a=!0;if(console.log("validando input"),"decimal"===o){console.log("onchange input decimal");let o=$(e).val(),t=o.split(".");console.log("input : ",e," - val",$(e).val()),console.log("res: ",t),console.log("res length: ",t.length),""!==o&&""!==t[0]||($(e).val(""),a=!1),t.length>1&&$(e).val(t[0].concat(".").concat(t[1].substring(0,2)))}else if("porcentaje"===o){console.log("onchange input porcentaje");let o=$(e).val(),t=o.split(".");if(console.log("input : ",e," - val",$(e).val()),console.log("res: ",t),console.log("res length: ",t.length),""!==o&&""!==t[0]||($(e).val(""),a=!1),t.length>1&&$(e).val(t[0].concat(".").concat(t[1].substring(0,3))),a){let o=parseFloat($(e).val(),3);o>100&&(a=!1)}}else if("fecha"===o){console.log("onchange input fecha");let o=$(e).val();moment(o,"DD/MM/YYYY").isValid()||(a=!1)}else if("rangos"===o){let o=parseFloat($(e).val(),2),n=parseFloat($(t).val(),2);o>=n&&(a=!1)}else if("fechas"===o){let o=moment($(e).val(),"DD/MM/YYYY").toDate(),n=moment($(t).val(),"DD/MM/YYYY").toDate();o>=n&&(a=!1)}else if("Entero"===o){console.log("onchange input decimal");let o=$(e).val(),t=o.split(".");console.log("input : ",e," - val",$(e).val()),console.log("res: ",t),console.log("res length: ",t.length),""!==o&&""!==t[0]||($(e).val(""),a=!1),t.length>1&&$(e).val(t[0])}return a};let showFabs=!0,btnCompact=$("#btnCompact"),fabContent=$("#divFloatContent");btnCompact.on("click",function(){funcCollapseFab()});const funcCollapseFab=()=>{showFabs?(btnCompact.addClass("btn-rotate-180"),fabContent.addClass("force-hide"),btnCompact.attr("data-original-title","Mostrar opciones")):(btnCompact.removeClass("btn-rotate-180"),fabContent.removeClass("force-hide"),btnCompact.attr("data-original-title","Ocultar opciones")),showFabs=!showFabs},clearListSelect=async(e=[])=>{$.each(e,function(e,o){$(o).html(""),$(o).selectpicker("refresh")})},hideOverflow=(e=!0,o="body")=>{e?$(o).addClass("Body-hide-overflow"):$(o).removeClass("Body-hide-overflow")};$(function(){methods.init()});
